---
layout: post
title:  "《Unit TestingPrinciples, Practices, and Patterns》读书笔记"
author: "Shuping Fang"
comments: true
tags: 读书笔记
excerpt: Vladimir Khorikov
---

## PART 1 The bigger picture

### 1 单元测试的目标

#### 1.1 单元测试现状
- 近些年，大家对单元测试的讨论，由应不应该做单元测试，转变为编写好的单元测试意味着什么。
- 很大一部分比例的项目所做的单元测试工作占比很大，可以达到1：1到1：3，即每1行产品代码对应1到3行的测试代码。更有甚者，可以达到1：10。
- 好坏单元测试的区别，不仅仅是个人偏好相关，更是决定你的项目成功与否的关键。

#### 1.2 单元测试的目标
- 书写单元测试有益于产生好的代码设计：难以开展单元测试的代码往往意味着这部分生产代码是紧耦合的、是糟糕的；反之，可高度单元测试的代码意味着生产代码是松耦合的，但松耦合的代码不意味着是高质量的代码。
- 书写单元测试使软件项目的可持续发展成为可能，是阻止软件项目熵增的有效手段。
<img src="/assets/imgs/7.jpg" width="75%" alt="AltText" />
<img src="/assets/imgs/8.jpg" width="75%" alt="AltText" />
- 添加单元测试的时候需要考虑性价比（单元测试可以创造的价值/该单元测试的维护成本），单元测试的维护成本决定于多项活动耗费的时间：底层代码重构后引起的测试代码重构、改产品代码时执行测试代码、处理单元测试产生的错误警报、阅读测试代码以理解底层代码的逻辑。
- 单元测试的代码并非多多益善，越多的代码意味着越高的维护成本。

#### 1.3 使用覆盖率指标来衡量单元测试的质量
覆盖率是指，当测试套件执行时，有多少产品源代码会被执行到。覆盖率有两种类型：代码覆盖率和分支覆盖率。开发者不能一味依赖覆盖率的数字来衡量单元测试的质量，此两者并非简单的正相关关系。<br>
(1)代码覆盖率指标<br>
<img src="/assets/imgs/9.jpg" width="50%" alt="AltText" />
由此公式可知，当把更多的生产代码挤在更少的行数中，即使测试代码没有任何区别，也会显著的提高代码覆盖率。<br>
(2)分支覆盖率指标<br>
分支覆盖率关注于代码的结构，以switch为例，如果生产代码共有5个case，测试代码可执行到4个case，则其分支覆盖率为80%。<br>
<img src="/assets/imgs/10.jpg" width="50%" alt="AltText" />
但上述两种方式都不能直接说明测试代码的质量，主要有两个原因：
(1)你不能保证测试验证了被测系统的所有可能结果，举例：<br>
<img src="/assets/imgs/11.png" width="100%" alt="AltText" />
上述例子中，无论是代码覆盖率还是分支覆盖率都是100%，但这段测试代码却是无意义的。<br>
(2)没有覆盖指标可以考虑外部库中的代码路径，举例：<br>
<img src="/assets/imgs/12.jpg" width="50%" alt="AltText" />
上述例子中，无论是代码覆盖率还是分支覆盖率也都是100%，但这段代码可以说是对int.Parse()方法完全测试了吗？并不是这样，一个详尽的测试方案可能是这样：
<img src="/assets/imgs/13.jpg" width="100%" alt="AltText" />
在实操过程中，可能有很多极端的边界情况，而我们没有好的办法来衡量边界情况的覆盖程度。<br>
综上，覆盖率指标是一种衡量单元测试质量的手段，但不能完全依赖覆盖率，更不能将具体数值的覆盖率作为团队目标。

#### 1.4 如何实现一个成功的test suite
没有任何自动化的方法可以衡量一个test suite是否成功。一个成功的test suite往往具备下述特征：
- 它集成在了开发周期中：改动再少的代码，也会执行到相应的单元测试。
- 它只关心你代码中最重要的部分：在大多数的应用中，业务代码往往是最重要的，针对业务做测试往往性价比最高。
- 它只需要很少的维护成本便可以实现较大的价值

#### 1.5 我们从这本书中可以学到什么
此书提供了一个衡量测试质量的参考框架，并分析现存的单元测试技术和实践，帮助你阐明为什么你一直使用的技术和最佳实践是有用的。帮助你：
- 如何重构test suite及其涵盖的生产代码
- 如何应用不同风格的单元测试
- 使用集成测试来验证整个系统的行为
- 识别和避免单元测试中的反模式
除了单元测试，此书还会介绍到集成测试和端到端的测试。


### 2 什么是单元测试
